<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>静态CDN - 文件浏览器</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{--primary-color:#2563eb;--bg-color:#f8fafc;--text-color:#1e293b;--border-color:#e2e8f0;--hover-color:#f1f5f9;--panel-bg:#ffffff}
    body.dark{--primary-color:#60a5fa;--bg-color:#0b1220;--text-color:#e2e8f0;--border-color:#1f2937;--hover-color:#111827;--panel-bg:#0f172a}
    body.theme-transition *{transition:background-color .35s ease,color .35s ease,border-color .35s ease}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;line-height:1.6;color:var(--text-color);background-color:var(--bg-color)}
    .container{max-width:1200px;margin:0 auto;padding:2rem}
    header{margin-bottom:2rem;padding-bottom:1rem;border-bottom:2px solid var(--border-color)}
    h1{font-size:2.5rem;color:var(--primary-color);margin-bottom:.5rem}
    .subtitle{color:#64748b;font-size:1.1rem}
    .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin:2rem 0;padding:1.5rem;background:var(--panel-bg);border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,.1)}
    .stat-item{text-align:center}
    .stat-value{font-size:2rem;font-weight:bold;color:var(--primary-color)}
    .stat-label{color:#64748b;font-size:.9rem}
    .controls{display:flex;gap:1rem;margin-bottom:1rem;flex-wrap:wrap}
    .search-box{flex:1;min-width:300px;padding:.75rem 1rem;border:2px solid var(--border-color);border-radius:6px;font-size:1rem;transition:border-color .2s}
    .search-box:focus{outline:none;border-color:var(--primary-color)}
    .view-toggle{display:flex;gap:.5rem}
    .view-btn{padding:.75rem 1.5rem;background:var(--panel-bg);border:2px solid var(--border-color);border-radius:6px;cursor:pointer;transition:all .2s}
    .view-btn.active{background:var(--primary-color);color:#fff;border-color:var(--primary-color)}
    .breadcrumb{margin:1rem 0;padding:.75rem;background:var(--panel-bg);border-radius:6px;font-size:.9rem;display:flex;flex-wrap:wrap;gap:.5rem;align-items:center}
    .breadcrumb .chip{display:inline-flex;align-items:center;gap:.4rem;padding:.35rem .6rem;border:1px solid var(--border-color);border-radius:999px;background:var(--hover-color)}
    .breadcrumb .chip a{color:var(--text-color);text-decoration:none}
    .breadcrumb .chip a:hover{color:var(--primary-color)}
    .breadcrumb .sep{opacity:.6}
    #file-tree{background:var(--panel-bg);border-radius:8px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.1)}
    .tree-view,.grid-view{display:none}
    .tree-view.active,.grid-view.active{display:block}
    .tree-item{display:flex;align-items:center;padding:.75rem 1rem;border-bottom:1px solid var(--border-color);text-decoration:none;color:inherit;transition:background-color .2s}
    .tree-item:hover{background-color:var(--hover-color)}
    .tree-icon{width:24px;height:24px;margin-right:.75rem;opacity:.7}
    .tree-name{flex:1;word-break:break-all}
    .tree-meta{font-size:.85rem;color:#64748b;margin-left:1rem;white-space:nowrap}
    .grid-view{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:1rem;padding:1rem}
    .grid-item{display:block;padding:1rem;background:var(--panel-bg);border:1px solid var(--border-color);border-radius:10px;text-decoration:none;color:inherit;transition:transform .18s,box-shadow .18s}
    .grid-item:hover{transform:translateY(-2px);box-shadow:0 4px 10px rgba(0,0,0,.12)}
    .grid-icon{font-size:2rem;margin-bottom:.5rem}
    .grid-name{font-weight:600;margin-bottom:.25rem;word-break:break-all}
    .grid-meta{font-size:.8rem;color:#64748b}
    .grid-badge{display:inline-block;margin-top:.25rem;padding:.15rem .4rem;border:1px solid var(--border-color);border-radius:999px;font-size:.75rem;color:#64748b}
    .loading{text-align:center;padding:3rem;color:#64748b}
    .error{text-align:center;padding:3rem;color:#dc2626}
    footer{margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border-color);text-align:center;color:#64748b;font-size:.9rem}
    .header-actions{display:flex;gap:.75rem;align-items:center;margin-top:.75rem}
    .theme-btn{padding:.5rem 1rem;border:2px solid var(--border-color);border-radius:6px;background:var(--panel-bg);color:var(--text-color);cursor:pointer;display:inline-flex;align-items:center;gap:.5rem}
    .theme-btn:hover{transform:translateY(-1px)}
    @media (max-width:768px){.container{padding:1rem}.stats{grid-template-columns:1fr 1fr}.search-box{min-width:100%}}
  </style>
  <meta http-equiv="Cache-Control" content="no-store" />
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-cloud"></i> 静态CDN文件浏览器</h1>
      <p class="subtitle">浏览和管理您的静态资源文件</p>
      <div class="header-actions">
        <button id="theme-toggle" class="theme-btn"><i class="fas fa-moon"></i><span>深色模式</span></button>
      </div>
    </header>
    <div class="stats" id="stats">
      <div class="stat-item"><div class="stat-value" id="total-folders">0</div><div class="stat-label">文件夹</div></div>
      <div class="stat-item"><div class="stat-value" id="total-files">0</div><div class="stat-label">文件</div></div>
      <div class="stat-item"><div class="stat-value" id="total-size">0</div><div class="stat-label">总大小</div></div>
      <div class="stat-item"><div class="stat-value" id="last-updated">-</div><div class="stat-label">最后更新</div></div>
    </div>
    <div class="controls">
      <input type="text" class="search-box" id="search" placeholder="搜索文件或文件夹...">
      <div class="view-toggle">
        <button class="view-btn active" data-view="tree"><i class="fas fa-list"></i> 列表视图</button>
        <button class="view-btn" data-view="grid"><i class="fas fa-th-large"></i> 网格视图</button>
      </div>
    </div>
    <div class="breadcrumb" id="breadcrumb"><span class="chip"><a href="#" data-path="">根目录</a></span></div>
    <div id="file-tree"><div class="tree-view active" id="tree-view"></div><div class="grid-view" id="grid-view"></div></div>
    <footer>
      <p>静态CDN文件浏览器 | 最后构建时间: <span id="build-time">-</span></p>
      <p>点击文件可直接访问，右键复制链接地址</p>
    </footer>
  </div>
  <script>
    function getFileIcon(item){
      if(item.type==='directory')return '<i class="fas fa-folder"></i>'
      const icons={images:'fa-file-image',videos:'fa-file-video',audio:'fa-file-audio',documents:'fa-file-lines',scripts:'fa-file-code',styles:'fa-file-code',html:'fa-file-code',archives:'fa-file-archive',data:'fa-file-csv',fonts:'fa-font',other:'fa-file'}
      const icon=icons[item.ft]||icons.other
      return `<i class="fas ${icon}"></i>`
    }
    function getFileColor(item){
      if(item.type==='directory')return '#3b82f6'
      const colors={images:'#10b981',videos:'#8b5cf6',audio:'#ec4899',documents:'#f59e0b',scripts:'#ef4444',styles:'#f97316',html:'#6366f1',archives:'#8b5cf6',data:'#06b6d4',fonts:'#14b8a6',other:'#6b7280'}
      return colors[item.ft]||colors.other
    }
    function formatBytes(bytes){
      if(!bytes||bytes===0)return ''
      const k=1024;const sizes=['Bytes','KB','MB','GB','TB']
      const i=Math.floor(Math.log(bytes)/Math.log(k))
      return parseFloat((bytes/Math.pow(k,i)).toFixed(2))+' '+sizes[i]
    }
    function renderBreadcrumb(path){
      const parts=path?path.split('/').filter(p=>p):[]
      let html='<span class="chip"><a href="#" data-path="">根目录</a></span>'
      parts.forEach((part,index)=>{const p=parts.slice(0,index+1).join('/');html+=` <span class="sep">/</span> <span class="chip"><a href="#" data-path="${p}">${part}</a></span>`})
      document.getElementById('breadcrumb').innerHTML=html
      document.querySelectorAll('#breadcrumb a').forEach(link=>{link.addEventListener('click',e=>{e.preventDefault();renderFileTree(link.dataset.path)})})
    }
    function renderFileTree(currentPath=''){
      let items=window.siteData?.items||[]
      if(currentPath){
        const parts=currentPath.split('/')
        for(const part of parts){
          const found=items.find(i=>i.name===part&&i.type==='directory')
          if(found)items=found.children||[]
          else{items=[];break}
        }
      }
      const term=document.getElementById('search').value.trim().toLowerCase()
      if(term){
        items=searchAll(window.siteData.items,term)
        renderBreadcrumb('搜索: '+term)
      }else{
        renderBreadcrumb(currentPath)
      }
      renderTreeView(items)
      renderGridView(items)
      window.currentPath=currentPath
      try{localStorage.setItem('lastPath',currentPath)}catch(_){}
    }
    function searchAll(items,term){
      const out=[]
      const walk=(list)=>{
        for(const it of list){
          if(it.name.toLowerCase().includes(term)) out.push(it)
          if(it.type==='directory'&&it.children) walk(it.children)
        }
      }
      walk(items)
      return out
    }
    function renderTreeView(items){
      const container=document.getElementById('tree-view')
      if(items.length===0){container.innerHTML='<div class="loading">没有找到文件</div>';return}
      let html=''
      items.forEach(item=>{
        const icon=getFileIcon(item)
        const color=getFileColor(item)
        if(item.type==='directory'){
          html+=`<a href="#" class="tree-item directory" data-name="${item.name}" data-path="${item.path}"><span class="tree-icon" style="color:${color}">${icon}</span><span class="tree-name">${item.name}</span><span class="tree-meta">${item.fc||0} 个项目</span><i class="fas fa-chevron-right tree-meta"></i></a>`
        }else{
          const href = item.ft==='fonts'?(`/font-preview.html?src=${encodeURIComponent(item.url)}`):item.url
          const isExternal=/^https?:\/\//.test(href)&&!href.startsWith(location.origin)
          const targetAttr=isExternal?' target="_blank"':''
          html+=`<a href="${href}" class="tree-item file"${targetAttr} data-origin-url="${item.url}"><span class="tree-icon" style="color:${color}">${icon}</span><span class="tree-name">${item.name}</span><span class="tree-meta">${formatBytes(item.sz)||''}</span></a>`
        }
      })
      container.innerHTML=html
      container.querySelectorAll('.directory').forEach(dir=>{dir.addEventListener('click',e=>{e.preventDefault();renderFileTree(dir.dataset.path)})})
      container.querySelectorAll('.file').forEach(file=>{
        file.addEventListener('contextmenu',e=>{e.preventDefault();const origin=file.getAttribute('data-origin-url')||file.getAttribute('href');navigator.clipboard.writeText(window.location.origin+origin).then(()=>alert('链接已复制到剪贴板')).catch(()=>alert('复制失败'))})
      })
    }
    function renderGridView(items){
      const container=document.getElementById('grid-view')
      if(items.length===0){container.innerHTML='';return}
      let html=''
      items.forEach(item=>{
        const icon=getFileIcon(item)
        const color=getFileColor(item)
        if(item.type==='directory'){
          html+=`<a href="#" class="grid-item directory" data-name="${item.name}" data-path="${item.path}"><div class="grid-icon" style="color:${color}">${icon}</div><div class="grid-name">${item.name}</div><div class="grid-meta">${item.fc||0} 个项目</div></a>`
        }else{
          const href = item.ft==='fonts'?(`/font-preview.html?src=${encodeURIComponent(item.url)}`):item.url
          const isExternal=/^https?:\/\//.test(href)&&!href.startsWith(location.origin)
          const targetAttr=isExternal?' target="_blank"':''
          html+=`<a href="${href}" class="grid-item file"${targetAttr}><div class="grid-icon" style="color:${color}">${icon}</div><div class="grid-name">${item.name}</div><div class="grid-meta">${formatBytes(item.sz)||''}</div><span class="grid-badge">${item.ext}</span></a>`
        }
      })
      container.innerHTML=html
      container.querySelectorAll('.directory').forEach(dir=>{dir.addEventListener('click',e=>{e.preventDefault();renderFileTree(dir.dataset.path)})})
    }
    function updateStats(data){
      document.getElementById('total-folders').textContent=data.sum.dirs.toLocaleString()
      document.getElementById('total-files').textContent=data.sum.files.toLocaleString()
      document.getElementById('total-size').textContent=data.sum.sizef
      const date=new Date(data.generatedAt)
      document.getElementById('last-updated').textContent=date.toLocaleDateString()+' '+date.toLocaleTimeString()
      document.getElementById('build-time').textContent=date.toLocaleString()
    }
    async function loadSiteData(){
      const candidates=['sitemap.json','/sitemap.json']
      let data=null
      for(const url of candidates){
        try{
          const res=await fetch(`${url}?t=${Date.now()}`,{cache:'no-store'})
          if(!res.ok) continue
          data=await res.json()
          break
        }catch(_){}
      }
      if(!data){
        document.getElementById('file-tree').innerHTML='<div class="error">无法加载文件列表，请使用本地服务器或刷新页面重试</div>'
        return
      }
      window.siteData=data
      updateStats(data)
      document.getElementById('file-tree').innerHTML='<div class="tree-view active" id="tree-view"></div><div class="grid-view" id="grid-view"></div>'
      let initPath=''
      try{initPath=localStorage.getItem('lastPath')||''}catch(_){initPath=''}
      renderFileTree(initPath)
    }
    document.addEventListener('DOMContentLoaded',()=>{
      loadSiteData()
      let t
      document.getElementById('search').addEventListener('input',()=>{clearTimeout(t);t=setTimeout(()=>{renderFileTree(window.currentPath||'')},300)})
      document.querySelectorAll('.view-btn').forEach(btn=>{btn.addEventListener('click',()=>{document.querySelectorAll('.view-btn').forEach(b=>b.classList.remove('active'));document.querySelectorAll('.tree-view,.grid-view').forEach(v=>v.classList.remove('active'));btn.classList.add('active');document.getElementById(`${btn.dataset.view}-view`).classList.add('active')})})
      document.addEventListener('keydown',e=>{if(e.key==='Escape'){document.getElementById('search').value='';renderFileTree(window.currentPath||'')}})
      if('serviceWorker' in navigator){
        (async()=>{
          try{
            const regs=await navigator.serviceWorker.getRegistrations();
            for(const r of regs){ await r.unregister().catch(()=>{}) }
            if(window.caches){ try{ const keys=await caches.keys(); await Promise.all(keys.map(k=>caches.delete(k))) }catch(_){} }
            if(!sessionStorage.getItem('sw_cleared')){ sessionStorage.setItem('sw_cleared','1'); location.reload() }
          }catch(_){}
        })()
      }
    })
  </script>
  <script>
    (function(){
      function setTheme(theme){
        const body=document.body
        body.classList.add('theme-transition')
        if(theme==='dark')body.classList.add('dark'); else body.classList.remove('dark')
        localStorage.setItem('theme',theme)
        const btn=document.getElementById('theme-toggle')
        if(btn){
          const icon=btn.querySelector('i')
          btn.querySelector('span').textContent=theme==='dark'?'浅色模式':'深色模式'
          icon.className=theme==='dark'?'fas fa-sun':'fas fa-moon'
        }
      }
      document.addEventListener('DOMContentLoaded',function(){
        const init=localStorage.getItem('theme')||(window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light')
        setTheme(init)
        const btn=document.getElementById('theme-toggle')
        if(btn){
          btn.addEventListener('click',function(){
            const next=document.body.classList.contains('dark')?'light':'dark'
            const icon=btn.querySelector('i')
            btn.animate([{transform:'scale(1)'},{transform:'scale(1.08)'},{transform:'scale(1)'}],{duration:450,easing:'cubic-bezier(.28,.84,.42,1)'})
            icon.animate([{transform:'rotate(0deg)'},{transform:'rotate(180deg)'},{transform:'rotate(360deg)'}],{duration:600,easing:'cubic-bezier(.2,.7,.2,1)'})
            setTheme(next)
          })
        }
        function hideIndexIfRoot(){
          if((window.currentPath||'')===''){
            const hiddenNames=['index.html','font-preview.html','README.md']
            document.querySelectorAll('#tree-view .file .tree-name').forEach(function(el){ if(hiddenNames.includes(el.textContent)){ var a=el.closest('a'); if(a) a.remove(); } })
            document.querySelectorAll('#grid-view .file .grid-name').forEach(function(el){ if(hiddenNames.includes(el.textContent)){ var a=el.closest('a'); if(a) a.remove(); } })
          }
        }
        var _origRenderTreeView=window.renderTreeView
        window.renderTreeView=function(items){ _origRenderTreeView(items); hideIndexIfRoot() }
        var _origRenderGridView=window.renderGridView
        window.renderGridView=function(items){ _origRenderGridView(items); hideIndexIfRoot() }
      })
    })()
  </script>
</body>
</html>